<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · GenParticleFilters.jl</title><meta name="title" content="Home · GenParticleFilters.jl"/><meta property="og:title" content="Home · GenParticleFilters.jl"/><meta property="twitter:title" content="Home · GenParticleFilters.jl"/><meta name="description" content="Documentation for GenParticleFilters.jl, a library for particle filtering and sequential Monte Carlo algorithms using Gen."/><meta property="og:description" content="Documentation for GenParticleFilters.jl, a library for particle filtering and sequential Monte Carlo algorithms using Gen."/><meta property="twitter:description" content="Documentation for GenParticleFilters.jl, a library for particle filtering and sequential Monte Carlo algorithms using Gen."/><meta property="og:url" content="https://probcomp.github.io/GenParticleFilters.jl/stable/"/><meta property="twitter:url" content="https://probcomp.github.io/GenParticleFilters.jl/stable/"/><link rel="canonical" href="https://probcomp.github.io/GenParticleFilters.jl/stable/"/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>GenParticleFilters.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Features"><span>Features</span></a></li><li><a class="tocitem" href="#Example"><span>Example</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="initialize/">Particle Initialization</a></li><li><a class="tocitem" href="update/">Particle Updating</a></li><li><a class="tocitem" href="resample/">Particle Resampling</a></li><li><a class="tocitem" href="rejuvenate/">Particle Rejuvenation</a></li><li><a class="tocitem" href="resize/">Particle Filter Resizing</a></li><li><a class="tocitem" href="translate/">Trace Translators</a></li><li><a class="tocitem" href="utils/">Data Structures and Utilities</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/probcomp/GenParticleFilters.jl" title="View the repository on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/probcomp/GenParticleFilters.jl/blob/master/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fas"></span></a><a class="docs-settings-button docs-navbar-link fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button docs-navbar-link fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="GenParticleFilters.jl"><a class="docs-heading-anchor" href="#GenParticleFilters.jl">GenParticleFilters.jl</a><a id="GenParticleFilters.jl-1"></a><a class="docs-heading-anchor-permalink" href="#GenParticleFilters.jl" title="Permalink"></a></h1><p>A library for simple and advanced particle filtering in <a href="https://www.gen.dev/">Gen</a>, a general-purpose probabilistic programming system.</p><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p>Press <code>]</code> at the Julia REPL to enter the package manager, then run:</p><pre><code class="language-julia hljs">add GenParticleFilters</code></pre><p>To install the development version, run:</p><pre><code class="language-julia hljs">add https://github.com/probcomp/GenParticleFilters.jl.git</code></pre><h2 id="Features"><a class="docs-heading-anchor" href="#Features">Features</a><a id="Features-1"></a><a class="docs-heading-anchor-permalink" href="#Features" title="Permalink"></a></h2><p>In addition to basic particle filtering functionality (i.e., initializing a particle filter and updating it with new observations), this package provides support for:</p><ul><li>Particle updates that allow discarding of old choices, provided that backward kernels are specified <a href="#1">[1]</a></li><li>Multiple resampling methods, including variance-reducing methods such as residual resampling <a href="#2">[2]</a></li><li>Custom priority weights for resampling, to control the aggressiveness of pruning <a href="#3">[3]</a></li><li>Metropolis-Hasting (i.e. move-accept) rejuvenation moves, to increase particle diversity <a href="#4">[4]</a></li><li>Move-reweight rejuvenation, which increases particle diversity while reweighting particles <a href="#5">[5]</a></li><li>Sequential Monte Carlo over a series of distinct models, via <a href="https://www.gen.dev/stable/ref/trace_translators/">trace translators</a> <a href="#6">[6]</a></li><li>SMCP³, a method which generalizes <a href="#1">[1]</a>, <a href="#5">[5]</a> and <a href="#6">[6]</a> through particle updates that support auxiliary randomness and deterministic transformations  <a href="#7">[7]</a></li><li>Particle filter resizing methods, which can be used in online adaptation of the total number of particles <a href="#8">[8]</a></li><li>Utility functions to compute distributional statistics (e.g. mean and variance) for the inferred latent variables</li></ul><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><p>Suppose we are trying to infer the position <code>y</code> of an object that is either staying still or moving sinusoidally, given noisy measurements <code>y_obs</code>. We can write a model of this object&#39;s motion as an <code>@gen</code> function:</p><pre><code class="language-julia hljs">@gen function object_motion(T::Int)
    y, moving = 0, false
    y_obs_all = Float64[]
    for t=1:T
        moving = {t =&gt; :moving} ~ bernoulli(moving ? 0.75 : 0.25)
        vel_y = moving ? sin(t) : 0.0
        y = {t =&gt; :y} ~ normal(y + vel_y, 0.01)
        y_obs = {t =&gt; :y_obs} ~ normal(y, 0.25)
        push!(y_obs_all, y_obs)
    end
    return y_obs_all
end</code></pre><p>We can then construct a particle filter with resampling and rejuvenation moves, in order to infer both the object&#39;s position <code>y</code> and whether the object was <code>moving</code> at each timestep.</p><pre><code class="language-julia hljs">function particle_filter(observations, n_particles, ess_thresh=0.5)
    # Initialize particle filter with first observation
    n_obs = length(observations)
    obs_choices = [choicemap((t =&gt; :y_obs, observations[t])) for t=1:n_obs]
    state = pf_initialize(object_motion, (1,), obs_choices[1], n_particles)
    # Iterate across timesteps
    for t=2:n_obs
        # Resample and rejuvenate if the effective sample size is too low
        if effective_sample_size(state) &lt; ess_thresh * n_particles
            # Perform residual resampling, pruning low-weight particles
            pf_resample!(state, :residual)
            # Perform a rejuvenation move on past choices
            rejuv_sel = select(t-1=&gt;:moving, t-1=&gt;:y, t=&gt;:moving, t=&gt;:y)
            pf_rejuvenate!(state, mh, (rejuv_sel,))
        end
        # Update filter state with new observation at timestep t
        pf_update!(state, (t,), (UnknownChange(),), obs_choices[t])
    end
    return state
end</code></pre><p>We can then run the particle filter on a sequence of observations, e.g., of the object staying still for 5 timesteps then oscillating for 5 timesteps:</p><pre><code class="language-julia hljs"># Generate synthetic dataset of object motion
constraints = choicemap([(t =&gt; :moving, t &gt; 5) for t in 1:10]...)
trace, _ = generate(object_motion, (10,), constraints)
observations = get_retval(trace)
# Run particle filter with 100 particles
state = particle_filter(observations, 100)</code></pre><p>We can then use <code>mean</code> and <code>var</code> to compute the empirical posterior mean and variance for variables of interest:</p><pre><code class="language-julia hljs">julia&gt; mean(state, 5=&gt;:moving) |&gt; x-&gt;round(x, digits=2) # Prob. motion at t=5
0.07
julia&gt; var(state, 5=&gt;:moving) |&gt; x-&gt;round(x, digits=2) # Variance at t=5
0.07
julia&gt; mean(state, 6=&gt;:moving) |&gt; x-&gt;round(x, digits=2) # Prob. motion at t=6
0.95
julia&gt; var(state, 6=&gt;:moving) |&gt; x-&gt;round(x, digits=2) # Variance at t=6
0.05</code></pre><p>We see that the filter accurately infers a change in motion from <code>t=5</code> to <code>t=6</code>.</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><p>
<a id="1">[1]</a> P. D. Moral, A. Doucet, and A. Jasra, "Sequential Monte Carlo samplers," Journal of the Royal Statistical Society: Series B (Statistical Methodology), vol. 68, no. 3, pp. 411–436, 2006.
</p>
<p>
<a id="2">[2]</a> R. Douc and O. Cappé, "Comparison of resampling schemes for particle filtering," in ISPA 2005. Proceedings of the 4th International Symposium on Image and Signal Processing and Analysis, 2005., 2005, pp. 64-69.
</p>
<p>
<a id="3">[3]</a> R. Chen, "Sequential Monte Carlo methods and their applications," in Markov Chain Monte Carlo, vol. Volume 7, 0 vols., Singapore University Press, 2005, pp. 147–182.
</p>
<p>
<a id="4">[4]</a> N. Chopin, “A sequential particle filter method for static models,” Biometrika 89.3, 2000, pp. 539-552.
</p>
<p>
<a id="5">[5]</a> R. A. G. Marques and G. Storvik, "Particle move-reweighting strategies for online inference," Preprint series. Statistical Research Report, 2013.
</p>
<p>
<a id="6">[6]</a> M. Cusumano-Towner, B. Bichsel, T. Gehr, M. Vechev, and V. K. Mansinghka, “Incremental inference for probabilistic programs,” in Proceedings of the 39th ACM SIGPLAN Conference on Programming Language Design and Implementation, Philadelphia PA USA, Jun. 2018, pp. 571–585.
</p>
<p>
<a id="7">[7]</a> Lew, A. K., Matheos, G., Zhi-Xuan, T., Ghavamizadeh, M., Gothoskar, N., Russell, S., and Mansinghka, V. K. "SMCP3: Sequential Monte Carlo with Probabilistic Program Proposals." AISTATS, 2023.
</p>
<p>
<a id="8">[8]</a> V. Elvira, J. Míguez and P. M. Djurić, "Adapting the Number of Particles in Sequential Monte Carlo Methods Through an Online Scheme for Convergence Assessment," in IEEE Transactions on Signal Processing, vol. 65, no. 7, pp. 1781-1794, 1 April 2017, doi: 10.1109/TSP.2016.2637324.
</p></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="initialize/">Particle Initialization »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.28.0-DEV on <span class="colophon-date" title="Thursday 25 January 2024 17:01">Thursday 25 January 2024</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
