<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Particle Filter Resizing · GenParticleFilters.jl</title><meta name="title" content="Particle Filter Resizing · GenParticleFilters.jl"/><meta property="og:title" content="Particle Filter Resizing · GenParticleFilters.jl"/><meta property="twitter:title" content="Particle Filter Resizing · GenParticleFilters.jl"/><meta name="description" content="Documentation for GenParticleFilters.jl, a library for particle filtering and sequential Monte Carlo algorithms using Gen."/><meta property="og:description" content="Documentation for GenParticleFilters.jl, a library for particle filtering and sequential Monte Carlo algorithms using Gen."/><meta property="twitter:description" content="Documentation for GenParticleFilters.jl, a library for particle filtering and sequential Monte Carlo algorithms using Gen."/><meta property="og:url" content="https://probcomp.github.io/GenParticleFilters.jl/stable/resize/"/><meta property="twitter:url" content="https://probcomp.github.io/GenParticleFilters.jl/stable/resize/"/><link rel="canonical" href="https://probcomp.github.io/GenParticleFilters.jl/stable/resize/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">GenParticleFilters.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../initialize/">Particle Initialization</a></li><li><a class="tocitem" href="../update/">Particle Updating</a></li><li><a class="tocitem" href="../resample/">Particle Resampling</a></li><li><a class="tocitem" href="../rejuvenate/">Particle Rejuvenation</a></li><li class="is-active"><a class="tocitem" href>Particle Filter Resizing</a><ul class="internal"><li><a class="tocitem" href="#Resizing-via-multinomial-resampling"><span>Resizing via multinomial resampling</span></a></li><li><a class="tocitem" href="#Resizing-via-residual-resampling"><span>Resizing via residual resampling</span></a></li><li><a class="tocitem" href="#Resizing-via-optimal-resampling"><span>Resizing via optimal resampling</span></a></li><li><a class="tocitem" href="#Particle-replication"><span>Particle replication</span></a></li><li><a class="tocitem" href="#Particle-dereplication"><span>Particle dereplication</span></a></li><li><a class="tocitem" href="#Particle-coalescing"><span>Particle coalescing</span></a></li><li><a class="tocitem" href="#Particle-introduction"><span>Particle introduction</span></a></li></ul></li><li><a class="tocitem" href="../translate/">Trace Translators</a></li><li><a class="tocitem" href="../utils/">Data Structures and Utilities</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Reference</a></li><li class="is-active"><a href>Particle Filter Resizing</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Particle Filter Resizing</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/probcomp/GenParticleFilters.jl" title="View the repository on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/probcomp/GenParticleFilters.jl/blob/master/docs/src/resize.md" title="Edit source on GitHub"><span class="docs-icon fas"></span></a><a class="docs-settings-button docs-navbar-link fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button docs-navbar-link fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Particle-Filter-Resizing"><a class="docs-heading-anchor" href="#Particle-Filter-Resizing">Particle Filter Resizing</a><a id="Particle-Filter-Resizing-1"></a><a class="docs-heading-anchor-permalink" href="#Particle-Filter-Resizing" title="Permalink"></a></h1><p>Some particle filtering algorithms may adaptively resize the number of particles in order to trade-off time and accuracy, or temporarily replicate existing particles in order to better explore the state space. GenParticleFilters.jl supports these algorithms by providing methods for resizing or replicating particles.</p><article class="docstring"><header><a class="docstring-binding" id="GenParticleFilters.pf_resize!" href="#GenParticleFilters.pf_resize!"><code>GenParticleFilters.pf_resize!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">pf_resize!(state::ParticleFilterState, n_particles::Int,
           method=:multinomial; kwargs...)</code></pre><p>Resizes a particle filter by resampling existing particles until a total of  <code>n_particles</code> have been sampled. The resampling method can optionally be specified: <code>:multinomial</code> (default), <code>:residual</code> or <code>:optimal</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/GenParticleFilters.jl/blob/43c95fca21d8ffe875e42a243d5887f87768e06b/src/resize.jl#L8-L15">source</a></section></article><h2 id="Resizing-via-multinomial-resampling"><a class="docs-heading-anchor" href="#Resizing-via-multinomial-resampling">Resizing via multinomial resampling</a><a id="Resizing-via-multinomial-resampling-1"></a><a class="docs-heading-anchor-permalink" href="#Resizing-via-multinomial-resampling" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="GenParticleFilters.pf_multinomial_resize!" href="#GenParticleFilters.pf_multinomial_resize!"><code>GenParticleFilters.pf_multinomial_resize!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">pf_multinomial_resize!(state::ParticleFilterState, n_particles::Int;
                       kwargs...)</code></pre><p>Resizes a particle filter through multinomial resampling (i.e. simple random resampling) of existing particles until <code>n_particles</code> are sampled. Each trace (i.e. particle) is resampled with probability proportional to its weight.</p><p><strong>Keyword Arguments</strong></p><ul><li><code>priority_fn = nothing</code>: An optional function that maps particle weights to custom log priority scores (e.g. <code>w -&gt; w/2</code> for less aggressive pruning).</li><li><code>check = :warn</code>: Set to <code>true</code> to throw an error for invalid normalized  weights (all NaNs or zeros), <code>:warn</code> to issue warnings, or <code>false</code> to  suppress checks. In the latter two cases, zero weights will be renormalized  to uniform weights for resampling.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/GenParticleFilters.jl/blob/43c95fca21d8ffe875e42a243d5887f87768e06b/src/resize.jl#L29-L45">source</a></section></article><h2 id="Resizing-via-residual-resampling"><a class="docs-heading-anchor" href="#Resizing-via-residual-resampling">Resizing via residual resampling</a><a id="Resizing-via-residual-resampling-1"></a><a class="docs-heading-anchor-permalink" href="#Resizing-via-residual-resampling" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="GenParticleFilters.pf_residual_resize!" href="#GenParticleFilters.pf_residual_resize!"><code>GenParticleFilters.pf_residual_resize!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">pf_residual_resize!(state::ParticleFilterState, n_particles::Int;
                    kwargs...)</code></pre><p>Resizes a particle filter through residual resampling of existing particles. For each particle with normalized weight <span>$w_i$</span>, <span>$⌊n w_i⌋$</span> copies are resampled, where <span>$n$</span> is <code>n_particles</code>. The remainder are sampled with probability proportional to <span>$n w_i - ⌊n w_i⌋$</span> for each particle <span>$i$</span>.</p><p><strong>Keyword Arguments</strong></p><ul><li><code>priority_fn = nothing</code>: An optional function that maps particle weights to custom log priority scores (e.g. <code>w -&gt; w/2</code> for less aggressive pruning).</li><li><code>check = :warn</code>: Set to <code>true</code> to throw an error for invalid normalized  weights (all NaNs or zeros), <code>:warn</code> to issue warnings, or <code>false</code> to  suppress checks. In the latter two cases, zero weights will be renormalized  to uniform weights for resampling.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/GenParticleFilters.jl/blob/43c95fca21d8ffe875e42a243d5887f87768e06b/src/resize.jl#L69-L86">source</a></section></article><h2 id="Resizing-via-optimal-resampling"><a class="docs-heading-anchor" href="#Resizing-via-optimal-resampling">Resizing via optimal resampling</a><a id="Resizing-via-optimal-resampling-1"></a><a class="docs-heading-anchor-permalink" href="#Resizing-via-optimal-resampling" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="GenParticleFilters.pf_optimal_resize!" href="#GenParticleFilters.pf_optimal_resize!"><code>GenParticleFilters.pf_optimal_resize!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">pf_optimal_resize!(state::ParticleFilterState, n_particles::Int;
                   kwargs...)</code></pre><p>Resizes a particle filter through the optimal resampling algorithm for  Fearnhead and Clifford [1]. This guarantees that each resampled particle is  unique as long as all of the original particles are unique, while minimizing  the variance of the resulting weight distribution with respect to the original weight distribution. Note that <code>n_particles</code> should not be greater than the current number of particles.</p><p><strong>Keyword Arguments</strong></p><ul><li><code>check = :warn</code>: Set to <code>true</code> to throw an error for invalid normalized  weights (all NaNs or zeros), <code>:warn</code> to issue warnings, or <code>false</code> to  suppress checks. In the latter two cases, zero weights will be renormalized  to uniform weights for resampling.</li></ul><p>[1] Paul Fearnhead , Peter Clifford, On-Line Inference for Hidden Markov Models via Particle Filters, Journal of the Royal Statistical Society Series B: Statistical Methodology, Volume 65, Issue 4, November 2003, Pages 887–899, https://doi.org/10.1111/1467-9868.00421</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/GenParticleFilters.jl/blob/43c95fca21d8ffe875e42a243d5887f87768e06b/src/resize.jl#L126-L148">source</a></section></article><h2 id="Particle-replication"><a class="docs-heading-anchor" href="#Particle-replication">Particle replication</a><a id="Particle-replication-1"></a><a class="docs-heading-anchor-permalink" href="#Particle-replication" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="GenParticleFilters.pf_replicate!" href="#GenParticleFilters.pf_replicate!"><code>GenParticleFilters.pf_replicate!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">pf_replicate!(state::ParticleFilterState, n_replicates::Int;
              layout=:contiguous)</code></pre><p>Expands a particle filter by replicating each particle <code>n_replicates</code> times. </p><p>If <code>layout</code> is <code>:contiguous</code>, each particle&#39;s replicates will be arranged in a continguous block (e.g., replicates of the first particle will have indices <code>1:n_replicates</code>).</p><p>Otherwise, if <code>layout</code> is <code>:interleaved</code>, each particle&#39;s replicates will be interleaved with the replicates of the other particles (e.g., replicates of the first particle will have indices <code>1:n_replicates:N*n_replicates</code>, where <code>N</code> is the original number of particles).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/GenParticleFilters.jl/blob/43c95fca21d8ffe875e42a243d5887f87768e06b/src/resize.jl#L221-L235">source</a></section></article><h2 id="Particle-dereplication"><a class="docs-heading-anchor" href="#Particle-dereplication">Particle dereplication</a><a id="Particle-dereplication-1"></a><a class="docs-heading-anchor-permalink" href="#Particle-dereplication" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="GenParticleFilters.pf_dereplicate!" href="#GenParticleFilters.pf_dereplicate!"><code>GenParticleFilters.pf_dereplicate!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">pf_dereplicate!(state::ParticleFilterState, n_replicates::Int;
                layout=:contiguous, method=:keepfirst)</code></pre><p>Shrinks a particle filter by retaining one out of every <code>n_replicates</code> particles. The total number of particles must be a multiple of <code>n_replicates</code>.</p><p>If <code>layout</code> is <code>:contiguous</code>, each set of replicates is assumed to be arranged in a contiguous block (e.g., the first particle will be selected out of the indices <code>1:n_replicates</code>).</p><p>Otherwise, if <code>layout</code> is <code>:interleaved</code>, each set of replicates is assumed to be interleaved with others (e.g., the first particle will be selected out of the indices <code>1:n_replicates:N</code>, where <code>N</code> is the total number of particles).</p><p>Retained particles can be selected by different methods. If <code>method</code> is <code>:keepfirst</code>, only the first particle of each set of replicates is retained, exactly reversing the effect of <a href="#GenParticleFilters.pf_replicate!"><code>pf_replicate!</code></a>. If <code>method</code> is  <code>:sample</code>, the retained particle is sampled according to its normalized weight among the replicates.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/GenParticleFilters.jl/blob/43c95fca21d8ffe875e42a243d5887f87768e06b/src/resize.jl#L246-L266">source</a></section></article><h2 id="Particle-coalescing"><a class="docs-heading-anchor" href="#Particle-coalescing">Particle coalescing</a><a id="Particle-coalescing-1"></a><a class="docs-heading-anchor-permalink" href="#Particle-coalescing" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="GenParticleFilters.pf_coalesce!" href="#GenParticleFilters.pf_coalesce!"><code>GenParticleFilters.pf_coalesce!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">pf_coalesce!(state::ParticleFilterState; by=get_choices)</code></pre><p>Coalesces traces that are equivalent according to <code>by</code> (defaulting to <code>get_choices</code>). Each set of equivalent traces is replaced by a single trace with  weight equal to the sum of the original weights, multiplied by the ratio of  the number of coalesced traces to the number of original traces.</p><p>To ensure that coalesced traces are <em>identical</em>, set <code>by</code> to <code>identity</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/GenParticleFilters.jl/blob/43c95fca21d8ffe875e42a243d5887f87768e06b/src/resize.jl#L299-L308">source</a></section></article><h2 id="Particle-introduction"><a class="docs-heading-anchor" href="#Particle-introduction">Particle introduction</a><a id="Particle-introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Particle-introduction" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="GenParticleFilters.pf_introduce!" href="#GenParticleFilters.pf_introduce!"><code>GenParticleFilters.pf_introduce!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">pf_introduce!(state::ParticleFilterState,
              [model::GenerativeFunction, model_args::Tuple,]
              observations::ChoiceMap, n_particles::Int)

pf_introduce!(state::ParticleFilterState,
              [model::GenerativeFunction, model_args::Tuple,]
              observations::ChoiceMap, proposal::GenerativeFunction,
              proposal_args::Tuple, n_particles::Int)</code></pre><p>Introduce <code>n_particles</code> new traces into a particle filter, constrained to the provided <code>observations</code>. If <code>model</code> and <code>model_args</code> are omitted, then this function will use the same model and arguments as the first trace in the particle filter. A custom <code>proposal</code> can be used to propose choices.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/GenParticleFilters.jl/blob/43c95fca21d8ffe875e42a243d5887f87768e06b/src/resize.jl#L336-L350">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../rejuvenate/">« Particle Rejuvenation</a><a class="docs-footer-nextpage" href="../translate/">Trace Translators »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.28.0-DEV on <span class="colophon-date" title="Monday 18 March 2024 23:43">Monday 18 March 2024</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
